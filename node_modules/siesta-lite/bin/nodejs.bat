@echo off
setlocal ENABLEDELAYEDEXPANSION
:: get the directory in which the script reside
set DIR=%~dp0

:: the funky way of doing "which" in WindowsXP (later versions have "where")
set HAS_NODE=

@for %%i in (node.exe) do @if NOT "%%~$PATH:i"=="" (@set HAS_NODE="HAS_NODE")

if not defined HAS_NODE (
    echo "[ERROR]: Node executable (`node.exe`) is not installed or not available in the PATH"
    exit /B 9
)


set SCRIPT_ADDED=false
set ALL=

for %%X in (%*) do (
    set ARG=%%X

    IF "%ARG:~0,2%"=="--" (
        set ALL=!ALL! !ARG!
    ) ELSE (
        IF "%SCRIPT_ADDED%"=="false" (
            set SCRIPT_ADDED=true
            set ALL=!ALL! "%DIR%projects/default_nodejs_project.js"
        )

        set ALL=!ALL! !ARG!
    )
)

IF "%SCRIPT_ADDED%"=="false" (
    node "%DIR%projects/default_nodejs_project.js" !ALL!
) ELSE (
    node !ALL!
)
